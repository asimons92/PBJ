<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Document</title>
</head>
<body>
    <h1>Review Parsed Note</h1>

    <h2>Original Note:</h2>
    <p>{{ original_note }}</p>

    <h2>Parsed Notes:</h2>

<form method="post" action="/review">
    {% for record in parsed_notes %}
<div>
    <h3>Record {{ loop.index0 }}</h3>

    <table border="1" cellpadding="5">
        <tbody>
            {# simple fields first #}
            {% for key, value in record.simple.items() %}
            <tr>
                <td><strong>{{ key }}</strong></td>
                <td>
                    <input 
                    type="text" 
                    name="record_{{ loop.index0 }}_{{ key }}" 
                    value="{{ value }}"
                    >
                </td>
            </tr>
            {% endfor %}

            {# nested fields #}
            {% for key, value in record.nested.items() %}
            <tr>
                <td><strong>{{ key }}</strong></td>
                <td>
                    {% if value is mapping %}
                    <table border="1" cellpadding="3">
                        {% for k, v in value.items() %}
                        <div>
                            <label>{{ k }}</label>
                            <input
                                type="text"
                                name="record_{{loop.index0}}_{{key}}_{{k}}"
                                value="{{v}}"
                            >
                        </div>
                        {% endfor %}
                    </table>
                    {% elif value is sequence and not value is string %}
                    <ul>
                        {% for item in value %}
                        <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    {{ value }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if record.candidate_students %}
    <p><strong>Select correct student for "{{ record.student_name }}"</strong>:</p>
    <select name="record_{{ loop.index0 }}_student_id">
        <option value="">-- Select --</option>
        {% for candidate in record.candidate_students %}
        <option value="{{ candidate.id }}">{{ candidate.name }} ({{ candidate.similarity }}%)</option>
        {% endfor %}
    </select>
    <input type="hidden" name="record_{{ loop.index0 }}_student_name" value="{{ record.student_name }}">
    {% else %}
    <p><em>Matched student: {{ record.student_name }}</em></p>
    <input type="hidden" name="record_{{ loop.index0 }}_student_id" value="{{ record.student_id }}">
    <input type="hidden" name="record_{{ loop.index0 }}_student_name" value="{{ record.student_name }}">
    {% endif %}
    

</div>
{% endfor %}

<button type="submit">Submit</button>
</form>

</body>
</html>